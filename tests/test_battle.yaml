---
- config:
  - testset: "Battle"
  - timeout: 10
- test:
  - group: "Battle"
  - name: "Check if there is no battle with id 1"
  - url: "/battles/1"
  - expected_status: [404]
- test:
  - group: "Battle"
  - name: "Basic get"
  - url: "/battles/"
- test:
  - group: "User"
  - name: "Check if user 'creator' exists"
  - url: "/users/creator"
- test:
  - group: "Battle"
  - name: "Create new battle by username"
  - url: "/battles/"
  - method: "POST"
  - body: '{"name": "Nice battle", "latitude": "13", "longitude": "37", "username": "creator", "radius": "100", "description": "yes"}'
  - headers: {'Content-Type': 'application/json'}
  - expected_status: [201]
- test:
  - group: "Battle"
  - name: "Create new battle by user_id"
  - url: "/battles/"
  - method: "POST"
  - body: '{"name": "Yet another nice battle", "latitude": "13", "longitude": "37", "user_id": 1, "radius": "100", "description": "yes"}'
  - headers: {'Content-Type': 'application/json'}
  - expected_status: [201]
- test:
  - group: "Battle"
  - name: "Get single battle"
  - url: "/battles/1"
  - validators:
    - compare: {jsonpath_mini: 'name', expected: 'Nice battle'}
# - test:
#  - group: "Battle"
#  - name: "Get all battles in zero radius"
#  - url: "/battles/"
#  - body: '{"latitude": 0, "longitude": 0, "radius": 0}'
#  - validators:
#    - compare: {raw_body: '', comparator: "length_eq", expected: 0}
- test:
  - group: "Battle"
  - name: "Get all battles in extremely large radius"
  - url: "/battles/"
  - body: '{"latitude": 0, "longitude": 0, "radius": 1000000000}'
  - validators:
    - extract_test: {jmespath: "[0]", test: "exists"}
    - extract_test: {jmespath: "[10]", test: "not_exists"}
- test:
  - group: "Battle"
  - name: "Get entries of battle with id 1"
  - url: "/battles/1/entries"
- test:
  - group: "Battle"
  - name: "Change created battle"
  - url: "/battles/1"
  - method: "PUT"
  - body: '{"name": "Very nice battle"}'
  - headers: {'Content-Type': 'application/json'}
- test:
  - group: "Battle"
  - name: "Add entry 1"
  - url: "/entries/"
  - method: "POST"
  - body: '{"latitude": "13", "longitude": "37", "user_id": "2", "battle_id": "1"}'
  - headers: {'Content-Type': 'application/json'}
  - expected_status: [201]
- test:
  - group: "Battle"
  - name: "Add entry 2"
  - url: "/entries/"
  - method: "POST"
  - body: '{"latitude": "13", "longitude": "37", "user_id": "3", "battle_id": "1"}'
  - headers: {'Content-Type': 'application/json'}
  - expected_status: [201]
- test:
  - group: "Battle"
  - name: "Get voting"
  - url: "/battles/1/voting"
  - method: "GET"
  - headers: {'Content-Type': 'application/json'}
- test:
  - group: "Battle"
  - name: "Vote for entry 1 (vs entry 2)"
  - url: "/battles/1/voting"
  - method: "POST"
  - body: '{"voter_id": 1, "winner_id": 1, "loser_id": 2}'
  - headers: {'Content-Type': 'application/json'}
  - expected_status: [201]
- test:
  - group: "Battle"
  - name: "Delete created battle"
  - url: "/battles/1"
  - method: "DELETE"
  - headers: {'Content-Type': 'application/json'}
- test:
  - group: "Battle"
  - name: "Make sure it was deleted"
  - url: "/battles/1"
  - expected_status: [404]
  - headers: {'Content-Type': 'application/json'}